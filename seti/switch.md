# Доклад на тему 'Как работают коммутаторы, маршрутизаторы, IP, DNS и алгоритмы маршрутизации"

Мы поэтапно рассмотрим, как устроена сетевая инфраструктура — от передачи данных внутри офиса до глобальной маршрутизации в интернете. Это позволит сформировать целостное понимание того, как работают ключевые устройства и протоколы.

# Два ключевых уровня: L2 и L3

Чтобы понять логику работы сети, необходимо начать с базового разделения задач. Вся сетевая коммуникация строится на чётком разделении ответственности между уровнями. Сегодня мы сосредоточимся на двух самых важных для нашего обсуждения: канальном и сетевом.

### Канальный уровень, или уровень доступа к среде (Data Link Layer, L2), 
 отвечает за непосредственную доставку данных между двумя устройствами, подключёнными к одной физической среде. Он работает с аппаратными, «физическими» адресами — MAC-адресами. Можно провести аналогию с доставкой почты внутри одного большого здания: MAC-адрес — это номер конкретной комнаты. Устройство, которое управляет этой локальной доставкой внутри «здания» одной сети, называется коммутатор (switch).

### Сетевой уровень (Network Layer, L3) 
решает принципиально иную задачу — доставку данных между разными сетями, между разными «зданиями». Его язык — логические, иерархические IP-адреса. Они не привязаны к железу и могут назначаться гибко. Устройство, которое «мыслит» IP-адресами, анализирует их и принимает решение, в какую сторону отправить пакет для его движения через десятки других сетей к цели, — это маршрутизатор (router).

Таким образом, основа всего — это разделение: коммутатор работает с локальной доставкой по MAC-адресам, а маршрутизатор — с глобальной маршрутизацией по IP-адресам.

# Коммутатор (Switch) – "Интеллектуальный распорядитель" LAN

Итак, начнём с локального «интеллектуального распорядителя» — коммутатора. В отличие от устаревшего концентратора, который просто дублирует сигнал на все порты, коммутатор обладает памятью и логикой. Его работа строится на постоянном обучении и принятии решений на основе таблицы коммутации (MAC-address table).

## Процесс можно разбить на три ключевых действия:

### 1. Изучение (Learning):
 Когда коммутатор только включили, его таблица пуста. Как только устройство (например, компьютер А на порту 1) отправляет первый кадр, коммутатор считывает MAC-адрес отправителя и делает запись: «MAC-адрес А → порт 1». Он не знает, где находятся все остальные устройства, но начинает запоминать их местоположение.
### 2. Принятие решения (Forwarding Decision): 
Далее коммутатор смотрит на MAC-адрес получателя в этом кадре. Здесь возможны три сценария:

· Адрес известен (Unicast): Если адрес назначения (например, BB:BB:BB:BB:BB:BB) есть в таблице и привязан к порту 3, коммутатор выполняет точечную пересылку (Selective Forwarding) — отправляет кадр строго на порт 3. Это основа эффективности.

· Адрес неизвестен: Если адреса нет в таблице, коммутатор применяет затопление (Flooding) — отправляет кадр на все порты, кроме порта-источника. Это гарантирует доставку.

· Широковещательный адрес: Кадр с адресом FF:FF:FF:FF:FF:FF также затопляется на все порты.

### 3. Обновление: 
Как только устройство с неизвестным адресом откликнется, коммутатор немедленно занесёт его порт в таблицу. Со временем почти весь трафик становится точечным.

### Итог: 
Коммутатор создаёт изолированные сегменты, резко снижая количество ненужных коллизий и повышая общую безопасность и производительность локальной сети.

# Маршрутизатор (Router) – "Пограничник и навигатор"

Чтобы данные вышли за пределы локальной сети, необходим маршрутизатор — стратег, принимающий решения на стыке сетей. Его главная миссия — передавать пакеты между разными IP-сетями.

## Рассмотрим его работу на примере запроса из домашней сети в интернет:
### Шаг 1: 
Приём и извлечение пакета. Ваш компьютер отправляет пакет, указывая в качестве MAC-получателя адрес домашнего роутера. Маршрутизатор принимает кадр, «снимает» заголовки канального уровня и извлекает IP-пакет.
### Шаг 2: 
Анализ IP и консультация с таблицей маршрутизации. Это сердце процесса. Маршрутизатор изучает поле IP-адреса назначения в пакете. Затем он обращается к своей таблице маршрутизации — базе данных всех известных путей. Он ищет наиболее точное совпадение по принципу «самое длинное совпадение маски» (longest prefix match). Например, для адреса 8.8.8.8 он находит запись: «Сеть 0.0.0.0/0 (весь интернет) → отправить на шлюз 212.45.67.1 через интерфейс WAN».
### Шаг 3: 
Переупаковка и пересылка. Найдя маршрут, маршрутизатор создаёт новый кадр для следующего сегмента сети. В этом кадре:

 MAC-адресом отправителя становится MAC его исходящего интерфейса.

 MAC-адресом получателя — MAC следующего маршрутизатора (который он узнаёт через протокол ARP).

 Сам IP-пакет с исходными адресами отправителя и получателя остаётся неизменным.
### 4. Шаг 4: Отправка. 
Новый кадр отправляется по назначению. Этот процесс повторяется на каждом маршрутизаторе на пути пакета.

### Дополнительные функции:
Современный маршрутизатор также часто выполняет роль межсетевого экрана (фильтруя трафик), сервера DHCP (раздавая IP-адреса) и выполняет NAT — преобразование приватных адресов в публичный для выхода в интернет.

# Как устройства получают IP-адрес? (DHCP)

Прежде чем устройство сможет общаться через маршрутизатор, ему нужен IP-адрес. В 99% случаев это происходит автоматически по протоколу DHCP (Dynamic Host Configuration Protocol). Это классический пример диалога «клиент-сервер».

## Процесс получения адреса состоит из четырёх чётких этапов:

### 1. DHCP Discover: 
Устройство (клиент), подключаясь к сети, отправляет широковещательный запрос: «Я новый в этой сети. Есть здесь DHCP-сервер?».
### 2. DHCP Offer: 
Сервер (часто встроенный в маршрутизатор) слышит запрос, резервирует свободный IP из своего пула и отправляет ответ-предложение. В нём указан не только IP, но и маска подсети, адрес шлюза (сам роутер), адреса DNS-серверов и срок аренды адреса.
### 3. DHCP Request:
Клиент, получив одно или несколько предложений, выбирает одно и отправляет широковещательный запрос на его подтверждение: «Я принимаю предложение от этого сервера!».
### 4. DHCP Acknowledgement: 
Выбранный сервер отправляет финальное подтверждение, после которого клиент официально начинает использовать выданную конфигурацию.

Этот процесс аренды периодически обновляется. Для критически важного оборудования (серверы, принтеры) IP-адрес задаётся вручную (статическая настройка).

# DNS – "Телефонная книга Интернета"

Пользователь вводит в браузере google.com, а не 142.250.185.206. Превращением удобных имён в числовые IP-адреса занимается глобальная распределённая система DNS (Domain Name System).

## Разрешение имени, если его нет в локальном кэше, — это путешествие по иерархии серверов:

### 1. Клиент и Резолвер: 
Ваш компьютер отправляет запрос к DNS-резолверу (его адрес вы получили от DHCP). Резолвер обязуется найти ответ.
### 2. Корневые серверы:
Если у резолвера нет ответа в кэше, он идёт к корневым серверам (их 13 групп по миру). Он спрашивает: «Где найти серверы для .com?». Корневой сервер возвращает адреса серверов домена верхнего уровня (TLD).
### 3. TLD-серверы: 
Резолвер обращается к серверу .com и спрашивает: «Кто отвечает за google.com?». TLD-сервер даёт список авторитативных серверов для домена google.com.
### 4. Авторитативные серверы: 
Наконец, резолвер спрашивает у авторитативного сервера google.com: «Какой IP у google.com?». Тот, как окончательный источник истины, возвращает A-запись с IP-адресом.
### 5. Завершение: 
Резолвер кэширует результат и возвращает IP вашему компьютеру. Теперь браузер может установить соединение.

Эта система с распределением ответственности и кэшированием обеспечивает невероятную скорость и надёжность.

# Алгоритмы маршрутизации – "Логика выбора пути"
Как маршрутизатор в центре сети провайдера узнает путь к миллионам сетей? Он не хранит все маршруты разом. Он получает их динамически, общаясь с соседями по протоколам маршрутизации.

## 1. Статическая маршрутизация: 
Администратор прописывает каждый маршрут вручную. Это надёжно и безопасно в малых сетях, но абсолютно негибко и нефункционально при сбоях или в крупных инфраструктурах.

## 2. Динамическая маршрутизация: 
Маршрутизаторы обмениваются служебной информацией и строят таблицы автоматически. Здесь две основные философии:

### Дистанционно-векторные протоколы (Distance-Vector), например RIP.
Каждый маршрутизатор знает только о непосредственных соседях. Периодически он рассылает им всю свою таблицу, говоря: «Я знаю сеть X, она в N хопах от меня». Сосед добавляет +1 к метрике. Это просто, но ведёт к медленной сходимости и риску петель.
### Протоколы состояния каналов (Link-State), например OSPF. 
Здесь маршрутизатор рассылает не таблицу, а информацию о состоянии своих интерфейсов (линков): с кем соединён, какая стоимость канала. Эти данные распространяются по всей зоне, и каждый роутер строит полную идентичную карту топологии. Затем каждый независимо вычисляет кратчайшие пути до всех сетей с помощью алгоритма Дейкстры. Это даёт высокую скорость, отсутствие петель и отличную масштабируемость.

### Для глобального интернета используется BGP (Border Gateway Protocol). 
Он связывает между собой не отдельные маршрутизаторы, а целые автономные системы (AS) — сети крупных провайдеров и компаний. BGP передаёт не метрику, а путь (AS_PATH) — список AS, которые нужно пройти. Выбор маршрута в BGP часто определяется не технической оптимальностью, а политическими и коммерческими договорённостями.

# Взаимодействие всех компонентов

## Давайте соберём полную цепочку на примере одного вашего запроса в интернете:

1. Локальный старт: Ваш ноутбук, получив IP от DHCP, отправляет запрос. Коммутатор точечно доставляет его кадр к маршрутизатору.

2. Преобразование имени: Перед этим система выполнила DNS-запрос, чтобы превратить доменное имя в IP. Этот запрос также прошёл через маршрутизатор и был разрешён через иерархию серверов.

3. Начало маршрутизации: Ваш роутер, получив пакет с внешним IP-адресом, нашёл для него маршрут в своей таблице (часто — «по умолчанию») и отправил его провайдеру.

4. Путешествие по миру: Внутри сети провайдера маршрутизаторы, используя OSPF, быстро передали пакет к границе. Далее, на основе таблиц BGP, пакет передавался от одной автономной системы к другой, пока не достиг сети-получателя.

5. Возврат: Ответный пакет проделал, возможно, иной путь обратно, чтобы через ваш роутер и коммутатор вернуться на ваш компьютер.

## Финальный вывод: Современная сеть — это слаженная система.
 Коммутатор обеспечивает локальный порядок и скорость. Маршрутизатор принимает стратегические решения на стыках, используя интеллектуальные алгоритмы маршрутизации (RIP, OSPF, BGP). DHCP автоматически снабжает устройства «пропусками», а DNS работает как универсальный переводчик. Понимание этой чёткой, иерархической логики — ключ к управлению любой сетевой инфраструктурой.